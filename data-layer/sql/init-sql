CREATE EXTENSION IF NOT EXISTS timescaledb;
CREATE SCHEMA IF NOT EXISTS crypto;

CREATE TABLE IF NOT EXISTS crypto.symbols (

    symbol    TEXT PRIMARY KEY,
    exchange  TEXT NOT NULL,
    base      TEXT NOT NULL,
    quote     TEXT NOT NULL,
    is_active BOOLEAN NOT NULL DEFAULT TRUE
);


-- 1 minute data
CREATE TABLE IF NOT EXISTS crypto.ohlcv_1m (

    time    TIMESTAMPTZ      NOT NULL,
    symbol  TEXT             NOT NULL,
    open    DOUBLE PRECISION NOT NULL,
    high    DOUBLE PRECISION NOT NULL,
    low     DOUBLE PRECISION NOT NULL,
    close   DOUBLE PRECISION NOT NULL,
    volume  DOUBLE PRECISION NOT NULL,

    PRIMARY KEY(symbol, time),
    
);

SELECT create_hypertable(
    'crypto.ohlcv_1m', 
    'time',
    'symbol',
    number_partitions => 8, 
    if_not_exists => TRUE
    );

-- Index for time partition queries
CREATE INDEX IF NOT EXISTS ohlcv_1m_time_desc_idx
  ON crypto.ohlcv_1m (symbol, time DESC);
